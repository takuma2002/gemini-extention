# Gemini DM 返信アシスタント

このChrome拡張機能は、さまざまなダイレクトメッセージ（DM）サイトで、Gemini APIを利用して文脈に応じた返信を自動生成します。

## 主な機能

- **ポップアップUIによる高度な操作:** 拡張機能アイコンから専用のポップアップを開き、「返信スタイル」や「追加の指示」を指定して、より意図に沿った返信を生成できます。
- **文脈を理解した返信:** 現在の会話履歴を読み取り、流れを汲んだ自然な返信をGemini APIが生成します。
- **誤送信防止の確認ステップ:** 生成された返信は、まずポップアップ内に表示されます。内容を確認した上で、ボタン一つで安全に入力欄に挿入できます。
- **幅広いサイトに対応:** 特定のサイトに依存せず、さまざまなDMサイトで動作するように設計されています。（※1）
- **安全なAPIキー管理:** あなたのAPIキーは、ブラウザの安全なストレージにのみ保存されます。

## 使い方

### ステップ1: 拡張機能のインストール

1.  このリポジトリのファイルをダウンロードし、解凍します。
2.  Chromeブラウザで `chrome://extensions` を開きます。
3.  右上の「デベロッパーモード」をオンにします。
4.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックし、ダウンロードして解凍したフォルダを選択します。

### ステップ2: APIキーの設定

1.  [Google AI Studio](https://aistudio.google.com/app/apikey) にアクセスし、ご自身のGoogleアカウントでGemini APIキーを取得します。
2.  Chromeの拡張機能管理ページ (`chrome://extensions`) で、本拡張機能の「詳細」をクリックします。
3.  「拡張機能のオプション」を開きます。
4.  開かれた設定ページで、取得したAPIキーを入力し、「保存」ボタンを押します。

### ステップ3: 返信の生成 (新しい使い方)

1.  お好きなDMサイトを開き、**返信したい相手のメッセージ入力欄をクリックして、カーソルをアクティブな状態にします。**
2.  ブラウザのツールバー（右上）にある**拡張機能のアイコンをクリック**して、ポップアップを開きます。
3.  ポップアップ内で、「返信スタイル」を選択し、必要であれば「追加の指示」を入力します。
4.  「返信を生成」ボタンをクリックします。
5.  少し待つと、ポップアップ内にAIが生成した返信が表示されます。
6.  内容を確認し、問題がなければ**「ページに挿入」ボタンをクリック**します。
7.  クリックすると、ページの入力欄にテキストが自動で入力され、ポップアップは閉じます。

## 仕組み (新しい仕組み)

1.  **ポップアップ起動:** ユーザーが拡張機能アイコンをクリックすると、`popup.html`が表示されます。
2.  **ページ情報取得:** ポップアップ内の「生成」ボタンが押されると、`popup.js`は`content_script.js`に「現在アクティブな場所の会話HTMLをください」と依頼します。
3.  **APIへのリクエスト:** `popup.js`は、受け取ったHTMLとポップアップで入力された指示を`background.js`に渡します。`background.js`は、これらの情報から詳細なプロンプトを作成し、Gemini APIにリクエストを送信します。
4.  **結果の表示と挿入:** `background.js`から返ってきたテキストは、まずポップアップ内に表示されます。ユーザーが「挿入」ボタンを押すと、`popup.js`が`content_script.js`に「このテキストを入力欄に入れて」と最終的な指示を出します。

## 注意事項

- (※1) 本拡張機能は、一般的なウェブページの構造をヒューリスティック（経験則）に基づいて解析し、会話部分を特定します。そのため、一部の特殊な構造を持つサイトでは、正しく動作しない可能性があります。
- 本機能の利用には、ご自身のGemini APIキーが必要です。APIの利用状況によっては、Googleから利用料金が請求される場合があります。
- この拡張機能は、あくまで返信作成を補助するものです。生成された内容が常に最適であるとは限りませんので、送信前に必ずご自身で内容を確認・編集してください。
