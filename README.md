# AI DM 返信アシスタント

このChrome拡張機能は、さまざまなダイレクトメッセージ（DM）サイトで、AIを利用して文脈に応じた返信を自動生成します。

## 主な機能

- **ポップアップUIによる高度な操作:** 拡張機能アイコンから専用のポップアップを開き、「返信スタイル」や「追加の指示」を指定して、より意図に沿った返信を生成できます。
- **文脈を理解した返信:** 現在の会話履歴を読み取り、流れを汲んだ自然な返信をAIが生成します。
- **高精度な会話抽出:**
    - **サイト別アダプター:** Twitter(X)のような主要なサイトでは、そのサイト専用の解析ロジック（アダプター）を使用し、非常に高い精度で会話を抽出します。
    - **汎用ヒューリスティック:** 未対応のサイトでも、ページの構造から会話エリアを推測する汎用ロジックで動作します。
    - **ユーザーによる範囲指定:** 万が一、自動でのエリア特定に失敗した場合でも、ユーザーが手動で会話範囲をクリックして教えることができます。
- **誤送信防止の確認ステップ:** 生成された返信は、まずポップアップ内に表示されます。内容を確認した上で、「挿入」または「コピー」ボタンで安全に利用できます。
- **安全なAPIキー管理:** あなたのAPIキーは、ブラウザの安全なストレージにのみ保存されます。

## 使い方

### ステップ1: 拡張機能のインストール
(変更なし)
1.  このリポジトリのファイルをダウンロードし、解凍します。
2.  Chromeブラウザで `chrome://extensions` を開きます。
3.  右上の「デベロッパーモード」をオンにします。
4.  「パッケージ化されていない拡張機能を読み込む」ボタンをクリックし、ダウンロードして解凍したフォルダを選択します。

### ステップ2: APIキーの設定
(変更なし)
1.  [OpenRouter](https://openrouter.ai/keys) にアクセスし、ご自身のアカウントでAPIキーを取得します。
2.  Chromeの拡張機能管理ページ (`chrome://extensions`) で、本拡張機能の「詳細」をクリックします。
3.  「拡張機能のオプション」を開きます。
4.  開かれた設定ページで、取得したAPIキーを入力し、「保存」ボタンを押します。

### ステップ3: 返信の生成

1.  お好きなDMサイトを開きます。
2.  ブラウザのツールバーにある拡張機能アイコンをクリックして、ポップアップを開きます。
3.  ポップアップ内で、「返信スタイル」などを選択・入力します。
4.  「返信を生成」ボタンをクリックします。
5.  **もし会話エリアの特定に失敗した場合:** ポップアップに「手動でエリアを選択」ボタンが表示されます。これをクリックし、ページ上で会話が含まれるエリアをクリックして指定してください。
6.  **返信の確認と利用:**
    *   生成された返信がポップアップに表示されます。
    *   ページに入力欄があれば「ページに挿入」ボタンが、なければ「テキストをコピー」ボタンが表示されるので、クリックして利用します。

## 仕組み

1.  **ポップアップ起動:** ユーザーが拡張機能アイコンをクリックすると`popup.html`が表示されます。
2.  **ページ情報取得:** 「生成」ボタンが押されると、`popup.js`は`content_script.js`に会話HTMLの取得を依頼します。
3.  **アダプターによる解析:** `content_script.js`は、現在のサイトURLを確認します。
    *   もしTwitterのように対応済みのサイトであれば、専用の解析ロジック（アダプター）を使い、高精度で会話エリアを特定します。
    *   未対応のサイトであれば、汎用のヒューリスティックロジック（ページの構造からスクロールする部分を探すなど）で会話エリアを推測します。
4.  **APIへのリクエスト:** `popup.js`は、受け取ったHTMLとユーザーの指示を`background.js`に渡します。`background.js`は、これらを元に詳細なプロンプトを作成し、**OpenRouter API**にリクエストを送信します。
5.  **結果の表示と挿入/コピー:** AIからの返信はポップアップに表示され、ユーザーはボタン操作で入力欄に挿入、またはクリップボードにコピーできます。

## 注意事項
(変更なし)
- (※1) 本拡張機能は、主要サイト以外では、一般的なウェブページの構造をヒューリスティック（経験則）に基づいて解析します。そのため、一部の特殊な構造を持つサイトでは、正しく動作しない可能性があります。（その場合は手動選択機能やフィードバック機能をご利用ください。）
- 本機能の利用には、ご自身の**APIキー**が必要です。APIの利用状況によっては、サービス提供元から利用料金が請求される場合があります。
- この拡張機能は、あくまで返信作成を補助するものです。生成された内容が常に最適であるとは限りませんので、送信前に必ずご自身で内容を確認・編集してください。
